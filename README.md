новая запись:
# Документация по проекту "Экоманер"

## Содержание

1. **Обзор проекта**  
   1.1 Цель проекта  
   1.2 Основные компоненты системы  

2. **Структура проекта**  
   2.1 Фронтенд  
   2.2 Бэкенд  
   2.3 База данных  

3. **Деплой проекта**  
   3.1 Деплой фронтенда  
   3.2 Деплой бэкенда  
   3.3 Работа со статическими файлами  

4. **API проекта**  
   4.1 Общий обзор API  
   4.2 Авторизация и аутентификация  
   4.3 Описание основных эндпоинтов  

5. **Администрирование**  
   5.1 Управление пользователями  
   5.2 Резервное копирование базы данных  

6. **Частые ошибки и их решения**  
   6.1 Проблемы со статикой  
   6.2 Ошибки авторизации  
   6.3 Ошибки при миграциях базы данных  

7. **Рекомендации по разработке**  
   7.1 Как добавлять новые эндпоинты  
   7.2 Работа с фронтендом  
   7.3 Логирование и отладка  

8. **Контакты и поддержка**  
   8.1 Основные контакты  
   8.2 Полезные ссылки

---

### Примечания
- Документация будет расширяться в процессе разработки.
- Каждый раздел подробно описывает шаги и включает примеры команд или кода для выполнения задач.
- Пожалуйста, уточните, какой раздел следует описать в первую очередь.













старая запись:
# Ecomaner Project

Проект **Ecomaner** — это веб-приложение, построенное на **Django** (серверная часть) и **React** (клиентская часть), с использованием **Nginx** и **Gunicorn** для продакшен-сервера. Ниже приведено подробное описание инфраструктуры и работы приложения.

## Архитектура проекта

- **Клиентская часть**: React-приложение, собираемое в статические файлы.
- **Серверная часть**: Django-приложение, работающее через Gunicorn.
- **Обратный прокси**: Nginx, обрабатывающий запросы к серверу, статику и API.

## Локальная разработка

Для локальной разработки установите зависимости и запустите серверы для Django и React.

1. **Запуск Django-сервера**:
    ```bash
    python manage.py runserver
    ```

2. **Запуск React-сервера**:
    ```bash
    npm start
    ```

## Деплой на продакшен

### 1. Сборка React-приложения

Создайте оптимизированную сборку React-приложения:
```bash
npm run build







Настройка Nginx
Nginx используется для проксирования запросов к Django и раздачи статических файлов. Пример конфигурации для /etc/nginx/sites-available/ecomaner:

nginx
Копировать код
# HTTP сервер для автоматического перенаправления на HTTPS
server {
    listen 80;
    server_name ecomaner.com www.ecomaner.com;
    return 301 https://$host$request_uri;

    root /var/www/ecomaner.com/public_html;
    index index.html index.htm;

    location / {
        try_files $uri /index.html;
    }
}

# HTTPS сервер для Django и React-приложений
server {
    listen 443 ssl;
    server_name ecomaner.com www.ecomaner.com;

    # SSL сертификаты
    ssl_certificate /etc/letsencrypt/live/ecomaner.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/ecomaner.com/privkey.pem;

    # Статика Django
    location /static/ {
        alias /home/ecomaner_django/backend/staticfiles/;
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
    }

    # Медиа-файлы Django
    location /media/ {
        alias /home/ecomaner_django/backend/media/;
        expires 30d;
        add_header Cache-Control "public, max-age=2592000";
    }

    # API Django (Gunicorn)
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Статика React
    location / {
        root /home/ecomaner_django/frontend/build;
        try_files $uri /index.html;
    }
}
3. Настройка Django и Gunicorn
Запустите Gunicorn для обработки Django-запросов:

bash
Копировать код
gunicorn ecomaner_project.wsgi:application --bind 127.0.0.1:8000 --workers 3
4. SSL
Для обеспечения безопасности используется сертификат Let's Encrypt. Настройка сертификатов осуществляется в конфигурации Nginx.

Работа приложения
Полный цикл запроса
Запрос от клиента: Пользователь на сайте выполняет действие, запускающее запрос на https://ecomaner.com/api/.
Проксирование в Nginx:
Если это запрос к API (/api/...), Nginx перенаправляет его на Gunicorn (http://127.0.0.1:8000).
Если это запрос на статику (/static/ или /media/), Nginx обрабатывает его напрямую из соответствующих папок.
Если это запрос к React-приложению, Nginx раздаёт файлы из сборки React.
Обработка Django: Django обрабатывает API-запросы, обращается к базе данных при необходимости и формирует JSON-ответ.
Ответ от Nginx: Ответ от сервера возвращается клиенту, где React обновляет интерфейс на основе полученных данных.
Пример запроса на главную страницу
Пользователь заходит на сайт https://ecomaner.com/.
React отправляет запрос к https://ecomaner.com/api/main/home/.
Nginx перенаправляет запрос на Gunicorn, который обрабатывает его через Django.
Django возвращает данные, и они отображаются в React.
Примечания
SSL-сертификат: Убедитесь, что сертификаты SSL обновляются автоматически через cron.
Переменные окружения:
REACT_APP_API_BASE_URL: Используется в React для указания базового URL API.
Кэширование: Статические файлы кэшируются Nginx для оптимизации загрузки.
Возможные проблемы
403 Forbidden: Убедитесь, что директории и файлы имеют правильные права доступа.
404 для статики: Проверьте, что Nginx ссылается на правильные пути для статики.








Полный алгоритм внесения изменений на сайт
1. Подготовка изменений на локальной машине
Внесите необходимые изменения в код (будь то в React-приложении или Django API).
Тестируйте изменения локально, чтобы убедиться, что они работают корректно.
Коммит изменений:
Сделайте коммит изменений в Git, чтобы сохранить текущую версию.
bash
Копировать код
git add .
git commit -m "Описание изменений"
2. Загрузка изменений на сервер
Отправьте коммит на удалённый репозиторий (например, GitHub или GitLab):
bash
Копировать код
git push origin main
Войдите на продакшн-сервер по SSH:
bash
Копировать код
ssh root@ваш_сервер
Перейдите в папку проекта и обновите репозиторий:
bash
Копировать код
cd /home/ecomaner_django
git pull origin main
3. Обновление серверной части (Django)
Если вы внесли изменения в серверную часть (API или настройки Django):

Активируйте виртуальное окружение:
bash
Копировать код
source /home/ecomaner_django/myenv/bin/activate
Установите новые зависимости (если они были добавлены):
bash
Копировать код
pip install -r requirements.txt
Примените миграции (если были изменения в модели):
bash
Копировать код
python manage.py migrate
Соберите статические файлы:
bash
Копировать код
python manage.py collectstatic --noinput
4. Обновление клиентской части (React)
Если вы внесли изменения в React-приложение:

Перейдите в папку frontend:
bash
Копировать код
cd /home/ecomaner_django/frontend
Установите или обновите зависимости (если добавляли новые пакеты):
bash
Копировать код
npm install
Соберите продакшн-билд:
bash
Копировать код
NODE_OPTIONS="--max-old-space-size=512" npm run build
Проверьте, что файлы были успешно собраны в папке /home/ecomaner_django/frontend/build.
5. Перезапуск сервисов
Перезапустите Gunicorn, чтобы применить изменения в Django:
bash
Копировать код
sudo systemctl restart gunicorn
Перезапустите Nginx, чтобы обновить конфигурацию и применить новые статические файлы:
bash
Копировать код
sudo systemctl restart nginx
6. Проверка работы сайта
Перейдите на сайт и проверьте, что изменения были успешно применены.
Проверьте консоль браузера на наличие ошибок, связанных с загрузкой статики или API-запросами.
Если что-то не работает, проверьте логи на сервере:
Логи Nginx:
bash
Копировать код
sudo tail -f /var/log/nginx/error.log
Логи Gunicorn:
bash
Копировать код
sudo journalctl -u gunicorn -f
7. Возможные проблемы и их решение
Ошибка 404 для статических файлов: Убедитесь, что папка /static/ правильно указана в конфигурации Nginx и что файлы собраны корректно.
403 Forbidden для статики: Проверьте права доступа на папку staticfiles.
Проблемы с кешированием: Если изменения на фронте не отображаются, попробуйте сбросить кеш в браузере или добавить заголовок Cache-Control для статики.
Примерный README.md по внесению изменений
markdown
Копировать код
# Алгоритм внесения изменений на сайт Ecomaner

Этот алгоритм описывает шаги для обновления и деплоя изменений на продакшн-сайт **Ecomaner**.

## 1. Локальные изменения и тестирование

1. Внесите изменения в код (React/Django).
2. Протестируйте локально.
3. Сделайте коммит и пуш на удалённый репозиторий:
   ```bash
   git add .
   git commit -m "Описание изменений"
   git push origin main
2. Загрузка изменений на сервер
Войдите на сервер:
bash
Копировать код
ssh root@ваш_сервер
Перейдите в папку проекта и обновите код:
bash
Копировать код
cd /home/ecomaner_django
git pull origin main
3. Обновление Django
Активируйте виртуальное окружение:
bash
Копировать код
source myenv/bin/activate
Установите зависимости:
bash
Копировать код
pip install -r requirements.txt
Примените миграции:
bash
Копировать код
python manage.py migrate
Соберите статику:
bash
Копировать код
python manage.py collectstatic --noinput
4. Обновление React
Перейдите в frontend:
bash
Копировать код
cd frontend
Установите зависимости:
bash
Копировать код
npm install
Создайте сборку:
bash
Копировать код
NODE_OPTIONS="--max-old-space-size=512" npm run build
5. Перезапуск серверов
bash
Копировать код
sudo systemctl restart gunicorn
sudo systemctl restart nginx
6. Проверка
Перейдите на сайт, убедитесь, что изменения применены, и проверьте консоль на ошибки.

go
Копировать код

Этот `README.md` можно разместить в корневой папке проекта, чтобы всегда иметь пошаговое руководство для деплоя.
